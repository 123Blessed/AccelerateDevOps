name: Starter Workflow

on:
  # Webhook events
  push:
    branches: 
      - 'release/*'
    paths-ignore: 
      - '.github/workflows'
  issues:
    types: [opened, edited, milestoned]
    
  # Scheduled events
  schedule:
    # - cron: '*/15 * * * *'
    # - cron: '0 9-17 * * *'
    - cron: '11 11 * * 5'

  # Manual events
  workflow_dispatch:
    inputs:
      homedrive:
        description: 'The home drive on the machine'
        required: true
        default: '/home'
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning' 
        type: choice
        options:
        - info
        - warning
        - debug 
      run_matrix:
        description: 'Run the matrix jobs'
        required: true 
        type: boolean 
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true 
        
  # Trigger using the API
  repository_dispatch:
    types: [customEvent]

  # Call for example using GitHub CLI:
  # $ gh api -X POST -H "Accept: application/vnd.github.v3+json" \
  # /repos/wulfland/AccelerateDevOps/dispatches \
  # -f event_type=customEvent

jobs:
  job_1:
    runs-on: ubuntu-latest
    
    steps:
      - run: echo "üéâ The job was triggered by a ${{ github.event_name }} event."
      - run: echo "üè† drive is `${{ github.event.inputs.homedrive }}`."
      - run: echo "üéØ environment is `${{ github.event.inputs.environment }}`."
      - run: echo "üìñ log level is `${{ github.event.inputs.logLevel }}`."
      - run: echo "‚ûø Run the matrix? `${{ github.event.inputs.run_matrix }}`."
      
      - name: Display Doc
        run: |
          echo "List all documentation:"
          tree
        working-directory: ch9_release/src/Tailwind.Traders.Web
        # working-directory: docs/
        # shell: bash
  
  job_2:
    runs-on: ubuntu-latest
    needs: job_1
    steps:
      - run: echo "Status ${{ job.status }}"
      
  job_3:
    runs-on: ubuntu-latest
    needs: job_1
    steps:
      - run: echo "Services ${{ job.services }}"
      
  job_4:
    runs-on: ubuntu-latest
    needs: [job_2, job_3]
    steps:
      - run: echo "Status ${{ job.status }}"
  
  matrix_job:
    name: matrix-job
    runs-on: ${{ matrix.runner }}
    if: github.event.inputs.run_matrix == 'true'
    
    strategy:
      matrix: 
        runner: [ubuntu-18.04, ubuntu-20.04]
        node: [10,12]
      fail-fast: true
      max-parallel: 4
    
    steps:
      - run: echo "${{ matrix.runner }}"
      - run: echo "${{ matrix.node }}"
